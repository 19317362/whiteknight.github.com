---
layout: bloggerpost
title: Kakapo Fixed!! (Mostly)
---

The lovable Austin Hastings has gotten Kakapo mostly working as of yesterday. It's not 100%, but I'm able to use it for some purposes such as getting the PLA test suite passing again.<br /><br />When I tried to build PLA last night, for the first time in a long time, the build failed. Some of the string handling functions I was using in the get_string VTABLEs were using old, deprecated functions in the string API. I took this as my opportunity to <a href="http://github.com/Whiteknight/parrot-linear-algebra/commit/444238a4a1746b3f5291f8687a11aed6660888a4">rewrite a lot of the logic</a> to use the new <a href="http://trac.parrot.org/parrot/browser/trunk/src/pmc/stringbuilder.pmc">StringBuilder</a> type instead. This should improve performance and bring PLA up to some of the modern best-practices of the Parrot community.<br /><br />When I tried to run the tests, however, KABLAMO. Kakapo wasn't happy and the tests wouldn't run. I tracked down a small series of problems, and put together a hasty patch. Austin pointed out that this wasn't the real solution, so he didn't want me to push it to the master at Gitorious. Instead, <a href="http://github.com/Whiteknight/kakapo/commit/a249c7709ee3fc21bb1431faf24a9693ee0ca982">I pushed to my mirror at Github</a>. This fix out of the way, the vast majority of the PLA test suite runs, and most tests were passing. This morning, I pushed another patch to my Kakapo mirror. After that, I'm proud to say, the PLA test suite passes 100% of important tests. That means I can start making preparations for <a href="http://wknight8111.blogspot.com/2010/07/kakapo-and-parrot-linear-algebra.html">an official release</a>, and then begin development on cool new features.<br /><br />Some people have asked me why I've gone through all this hassle; if I had just rewritten my testsuite without Kakapo it could have been working a long time ago. The answer to that question is pretty simple: I want the abstraction and insulation that Kakapo provides.<br /><br />To look at it another way, consider this: NQP has a test suite of it's own that needs to pass before it can make a release. If I'm using NQP, I know that the behavior NQP provides will be a little more stable than the underlying Parrot VM. However, NQP isn't a perfect overlay for Parrot: There are some features that Parrot provides that NQP doesn't cleanly wrap. To get an abstraction layer over those features, I need a framework like Kakapo. This is all not to mention that several other high-profile projects use NQP, so even if it's test suite isn't all-encompassing, the test suites of projects which build on top of NQP probably cover more ground.<br /><br />Kakapo likewise has a test suite, and that needs to pass before Kakapo gets released. If I'm using Kakapo, I can be certain that the API that it and NQP provide together should be relatively stable and are tested to work before they are released. Since we are talking about <a href="http://wknight8111.blogspot.com/2010/06/parrot-linear-algebra-change-of-course.html">tracking Parrot trunk</a> with PLA development, this stability is very welcome.<br /><br />What we've run into recently is a rare confluence of events where highly disruptive changes in Parrot caused major breakages in Kakapo. When Kakapo got fixed, the PLA test suite ran perfectly without any changes to the suite itself. Considering the magnitude of changes to Parrot recently, the ability for me to continue running the test suite without alterations is a pretty big and important aspect. Sure there was some down-time, but once our dependencies were fixed, our stuff worked again like magic.<br /><br />Kakapo isn't 100% yet, but Austin is still working on it and I'll be lending a hand. I'm also going to start making some progress in PLA, and see what I can do to help out with some of the performance improvements and other big tasks that are going on in Parrot too. Expect to see many more updates on things in the coming days and weeks.
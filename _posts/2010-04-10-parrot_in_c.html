---
layout: bloggerpost
title: Parrot in C#
publish: true
categories: [Parrot, C#]
---

Here's a little bit of proof-of-concept code that is going to interest a few people:<br /><pre>using System;<br />using System.Text;<br />using System.Runtime.InteropServices;<br /><br />public static class Program &#123;<br />    [DllImport("parrot")]<br />    private static extern System.IntPtr Parrot_new(System.IntPtr parent);<br /><br />    [DllImport("parrot")]<br />    private static extern void Parrot_destroy(System.IntPtr interp);<br /><br />    [DllImport("parrot", CharSet=CharSet.Ansi)]<br />    private static extern System.IntPtr Parrot_new_string(System.IntPtr interp,<br />        string text, int length, System.IntPtr whatever, int whatever2);<br /><br />    [DllImport("parrot", CharSet=CharSet.Ansi)]<br />    private static extern System.IntPtr Parrot_compile_string(System.IntPtr interp,<br />        System.IntPtr compiler_name, string code, StringBuilder errmsg);<br /><br />    [DllImport("parrot", CharSet=CharSet.Ansi)]<br />    private static extern void Parrot_ext_call(System.IntPtr interp,<br />        System.IntPtr sub, string sig);<br /><br />    public static void Main(string[] args) &#123;<br />        Console.WriteLine("Hello World from C#");<br /><br />        System.IntPtr interp = Parrot_new(System.IntPtr.Zero);<br />        System.IntPtr pir = Parrot_new_string(interp, "PIR", 3, System.IntPtr.Zero, 0);<br />        System.IntPtr sub = Parrot_compile_string(interp, pir, @"<br />            .sub 'foo'<br />                say 'Hello from PIR'<br />            .end",<br />            new StringBuilder(256)<br />        );<br /><br />        Parrot_ext_call(interp, sub, "->");<br />        Parrot_destroy(interp);<br /><br />        Console.WriteLine("Hello again from C#");<br />    &#125;<br />&#125;<br /></pre>I've been kicking around the idea of starting a project to do full bindings between Parrot and .NET. I'm not sure that I'm ready to take on a new project, especially not one of that magnitude, but it's fun to think about.<br /><br />I've got some more code examples for this that I'm putting together. Some of them can be pretty messy, especially when we talk about marshalling data between Parrot's various structures and C# code. However, I think it should be very possible to wrap all that messiness inside a series of nice, clean abstractions. It would be especially nice if we could get some scripts to parse through the embedding and extending function lists and generate the C# extern declarations automatically. With those, we can write some nice wrapper classes around the raw functions.<br /><br />I'm sure I'll have more to write about this in the days ahead.
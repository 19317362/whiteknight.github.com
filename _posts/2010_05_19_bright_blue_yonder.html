---
layout: bloggerpost
title: Bright Blue Yonder
---

Yesterday <a href="http://wknight8111.blogspot.com/2010/05/parrot-240-sulfur-crest-released.html">I released 2.4, "Sulfur Crest"</a>. It's a cooler, more succinct name than "<a href="http://en.wikipedia.org/wiki/Sulfur-crested_Cockatoo">Sulfur-Crested Cockatoo</a>". Every time I do a Parrot release I find myself searching through Wikipedia to look for interesting Parrot names (and colorful pictures too!).<br /><br />I picked an <i>interesting</i> quote for the release announcement. Amid the broken grammar and colorful imagery was a key point that I wanted to express: Parrot is getting smarter.<br /><br />If you had told me two years ago, or even a year ago, that Parrot would have the features it has now, or that it would be on the verge of adding the features that we are currently planning, I might have been incredulous. Parrot has matured a lot recently, and I really think all that effort is going to start paying off. <br /><br />Parrot had a lot of features when I first joined the project. Many of these were first drafts and prototypes which have since been ripped out or reimplemented. This is a normal, natural, healthy part of the software development process, and nobody should be surprised or upset about it. Pop quiz: Name for me one other dynamic language virtual machine, open-source or otherwise, that aims to support the same number of programming languages and runtime environments that Parrot aims to support? Smalltalk comes to mind as a virtual machine for a dynamic language, but that VM backend was never intended to support anything besides Smalltalk. At least, not well. .NET supports a few languages, but is certainly not dynamic.<br /><br />There's a great rule in programming that we always throw the first one away. The first draft is never the final manuscript, the first stab in the dark never hits the target. The original Parrot designers and developers didn't have a whole hell of a lot of prior art to copy from. They made some guesses, but there was no way they could have gotten everything right the first time, no way they could have forseen all the problems that the project would run into over time. But that lack of information and that uncertainty can't hold people back. You grit your teeth, you write a prototype, and you resolve to yourself that <i>you always throw the first one away</i>.<br /><br />Let's take JIT for an example. In a basic JIT system, you have a snippet of code with a runtime cost of <i>E</i>. A JIT attempts to compile that code into a piece of machine code with a runtime:<br /><br /><i>OE < E</i><br /><br />Where <i>O</i> is some sort of optimization factor. Of course, there is some kind of overhead <i>H</i>, in compiling the code at runtime:<br /><br /><i>H + OE < E</i><br /><br /><i>H</i> involves constructing the machine code and performing optimizations. The more optimizations we perform, the larger <i>H</i> gets, but the smaller <i>O</i> can get. If <i>E</i> is large enough and if we tune <i>H</i> properly, eventually we cross a threshold and the left side of the inequality becomes smaller than the right side of the equation. At this point, JIT is a net performance win for the application. Simple, right?<br /><br />Anyway, I'll skip the rest of the theory lesson. The point is this: Parrot's original JIT didn't really have anything a modern compiler system would recognize as "optimization passes", so it wasn't really tunable. It also didn't readily support code generation on any platform besides x86. These things weren't going to be easy (or, even possible) to add either. When the burden of maintenance became too high, and when it was clear that the old prototype system was doing more harm than good, <a href="http://wknight8111.blogspot.com/2009/09/jit-first-project-challenge.html">we ripped it out</a>.<br /><br />There were a number of such systems in early Parrot, prototype code that got Parrot up to the first plateau but needed to be redesigned and reimplemented for Parrot to move up to the next one.  There are several projects either going on right now, or about to get started to work on these systems. When you look at the list, you realize that while it's ambitious, with the current team and the current state of the VM it is entirely plausible that they will all succeed. A quick overview:<br /><br />Allison, Bacek and chromatic are talking about several ideas for implementing new, more efficient GC algorithms to replace our first GC prototype.<br /><br />Plobsing has been hard at work redoing our freeze/thaw serialization system and, along with NotFound and others is working to fix several long-standing bugs in the PBC system.<br /><br />Nat Tuck is preparing a GSoC project to<a href="http://www.parrot.org/content/hybrid-threads"> implement a new threading system</a> to replace the first prototype version of that system.<br /><br />Tyler Curtis is preparing a GSoC project to implement a first prototype of a <a href="http://www.parrot.org/content/past-optimization">PAST optimization system</a>.<br /><br />Daniel Arbelo is preparing his GSoC project to implement a first prototype of the <a href="http://www.parrot.org/content/what-nfg-why-you-want-parrot-have-it">NFG string normalization form</a>.<br /><br />Muhd Khairul Syamil Hashim Is putting together a GSoC project to implement an <a href="http://www.parrot.org/content/instrumenting-parrot">instrumentation framework</a> for Parrot so we can get some high-quality analysis and debugging tools for Parrot.<br /><br />John Harrison is preparing his GSoC project to develop a new NCI frame builder with LLVM, which will replace the old prototype frame builder and (hopefully) lay the groundwork to start replacing our prototype JIT system. <br /><br />...and there are even other projects that I can't think of off the top of my head right now too.<br /><br />If you had told me a year or two ago that all these projects would be on the table, or that we would have such high chances of them all succeeding, I would have called you crazy. But after all the work we've put in between then and now, and considering the high caliber of our development team, I'm feeling pretty confident that we will be successful and Parrot is going to gain some of these awesome new features. Cross  your fingers!
                <div class='old-blogger-comments'>
                    <h2 class='old-comment-header'>Comments</h3>
                <div class='blogger-comment-div'>
                <p class='blogger-comment-body'>
                    Thanks for the post Whiteknight.<br /><br />I have a lot of interest in parrot and have recently starting thinking of using this as a VM (instead of JVM) for a HLL I am working on.<br /><br />Technically, I want to go for Parrot as I want something dynamic and the tools Parrot provides are neat.<br /><br />However to be honest, its scary that over the last 10 years so much was done and discarded and is being rewritten. I agree with the "throw away the first" reasoning but that is something I would expect in a 2-3 year project not a 10 year old project.<br /><br />Could you comment on the risk associated with for a HLL project that starts to build on Parrot with an ETA of say 1 year? Can it be said with a reasonably level of certainity that whatever sub-projects (JIT, treads etc.) are added to Parrot now, they will take an evolutionary approach rather than being scrapped and rewritten?<br /><br />My intent is not to put down Parrot as I really want to use it but I want to voice my fears and hope to understand the parrot-dev perspective on making Parrot a stable (for some definition of stable) platform to build on.<br /><br />Thanks for all the fantastic work on Parrot.
                </p>
                <div class='blogger-comment-author-div'>
                    <span class='blogger-author-sig'>Anonymous
                    <span class='blogger-comment-datestamp'>
                        5/21/2010 7:46:24 AM
                    </span>
                </div>
            </div>
            <div class='blogger-comment-div'>
                <p class='blogger-comment-body'>
                    My response to this grew very large, so I wrote up a full blog post. You can see the reply at <br /><br /><a href="http://wknight8111.blogspot.com/2010/05/fitness-of-parrot-as-target-platform.html" rel="nofollow">http://wknight8111.blogspot.com/2010/05/fitness-of-parrot-as-target-platform.html</a>.<br /><br />Thanks for  the comment!
                </p>
                <div class='blogger-comment-author-div'>
                    <span class='blogger-author-sig'><a class='blogger-author-uri' href='http://www.blogger.com/profile/16207472474429254890'>Whiteknight</a>

                    <span class='blogger-comment-datestamp'>
                        5/21/2010 12:45:29 PM
                    </span>
                </div>
            </div>
            </div>

---
layout: bloggerpost
title: Parrot's libJIT framebuilder
publish: true
categories: [libJIT, JIT, Parrot]
---

I <a href="/2009/09/19/jit_first_project_challenge.html.html">offered a bit of a challenge</a> to my readers a while back, and I mentioned that I had received one (very good)<a href="/2009/10/01/libjit_nci_frame_builder_branch.html.html"> submission from plobsing</a>. It used libJIT to implement a frame builder for Parrot, to replace the old home-brew one that we had been using.<br /><br />I also <a href="http://irclog.perlgeek.de/parrotsketch/2009-11-10#i_1710948">hear tell</a> that he's planning a <a href="http://sourceware.org/libffi/">framebuilder using libffi</a> too, although I'll have to talk more about that in a later post.<br /><br />There were some bumps in the road, however. Regular readers will recognize that between the time he sent me the code and now the <a href="/2009/10/21/pcc_branch_lands.html.html">big PCC refactor landed</a>, which changed the landscape for anything involving function calls quite substantially. But plobsing persevered, and with some configuration help from our own kid51, we ended up with a very nice working branch running the new framebuilder.<br /><br />Assuming things test well, I would like to push to get the libjit_framebuilder branch merged into trunk soon. We need testing so here is something you, the reader, can do:<br /><br /><span style="font-size:180%;">Test the Branch</span><br /><br />Checkout the libjit_framebuilder branch and give it a whirl. You want to do this before you have libJIT installed on your system to get a baseline. Parrot should work normally without libJIT installed.<br /><br /><span style="font-size:180%;">Get libJIT</span><br /><br />Getting libJIT is probably the hardest part of the whole process. There don't seem to be any debian packages for downloading, and there definitely don't seem to be any Windows binary installers floating around. Google returns few results when I search for "libjit", mostly Wikipedia and plobsing's own work (not usually a good sign!).<br /><br />You can download the source to the mainline project <a href="ftp://ftp.gnu.org/gnu/dotgnu/libjit/">HERE</a>, and can apparently download source from a fork of it <a href="http://libjit-linear-scan-register-allocator.googlecode.com/files/libjit-0.1.2.5%2B.tar.gz">HERE</a> as well. If you have SVN, you can get the source of the fork from it's <a href="http://code.google.com/p/libjit-linear-scan-register-allocator">googlecode project</a>. I'm not really able to find a repo link for the project mainline. Maybe somebody else can help point me in the right direction for that.<br /><br />From the source you can type this to get it to build on Linux:<br /><pre><br />./configure<br />make<br />sudo make install<br /></pre><br />On my machine, I also had to run "<code>sudo ldconfig</code>" to update some kind of cache or something. I don't know the details, but if you're on Linux and it doesn't work, try that.<br /><br />I have no idea how to get this working on Windows. You may be SOL.<br /><span style="font-size:180%;"><br />Test the Branch Again</span><br /><br />Now that you have libJIT reconfigure, rebuild, and retest Parrot. It should detect libJIT, use it for the framebuilder, and (I hope) you should see some kind of performance improvement. At the very least, it shouldn't be noticeably slower.<br /><br /><span style="font-size:180%;">Send Reports</span><br /><br />If things work on your platform, let us know. If things don't work, we definitely need to know that as well. If you have any information about how to get or build libJIT on various systems, we would love to start compiling some documentation about that too. More information is always better, and if Parrot is going to use libJIT going forward (even as an optional component for some performance improvements) we should all be aware of how to get and use it.